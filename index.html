@ -1,552 +1,494 @@
<!doctype html>
<html lang="en">

<head>
  <!-- Modern favicon -->
  <meta charset="utf-8" />
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OurShow</title>
  <meta name="theme-color" content="#ef4444" />

  <!-- ‚úÖ PWA META TAGS -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="OurShow">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  <link rel="icon" href="/icons/icon-192x192.png">

  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Load firebase-config first (it provides window.db and window.auth safely if SDK missing) -->
  <script src="firebase-config.js"></script>

  <!-- Load API config (tmdbFetch & geminiCall helpers) -->
  <script src="config.js"></script>
</head>

<body class="bg-gray-900 text-white font-sans">

  <!-- Loading Screen -->
  <div id="loading-screen"
    class="fixed inset-0 z-[9999] flex items-center justify-center bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900">
    <div class="text-center">
      <!-- Animated Logo Container -->
      <div class="relative mb-8 flex items-center justify-center">
        <!-- Outer rotating ring -->
        <div
          class="absolute w-40 h-40 border-4 border-transparent border-t-red-600 border-r-pink-500 rounded-full animate-spin">
        </div>

        <!-- Inner pulsing ring -->
        <div
          class="absolute w-32 h-32 border-4 border-transparent border-b-red-500/50 border-l-pink-500/50 rounded-full"
          style="animation: spin 1.5s linear infinite reverse;"></div>

        <!-- Center Logo -->
        <div class="relative flex items-center gap-3">
          <div
            class="logo-badge flex items-center justify-center rounded-lg bg-gradient-to-br from-red-600 to-red-700 px-4 py-3 shadow-2xl animate-pulse">
            <span class="text-white font-extrabold text-2xl">OUR</span>
          </div>
        </div>
      </div>

      <!-- Brand Name -->
      <div class="mb-6">
        <div
          class="text-5xl font-extrabold bg-gradient-to-r from-red-500 to-pink-500 bg-clip-text text-transparent mb-2">
          Show
        </div>
        <div class="text-sm text-gray-400 tracking-wide">
          üé¨ discover ‚Ä¢ üí¨ discuss ‚Ä¢ ü§ñ recommend
        </div>
      </div>

      <!-- Loading Text -->
      <p class="text-gray-300 text-lg mb-6 animate-pulse">
        Loading your entertainment...
      </p>

      <!-- Progress Bar -->
      <div class="w-80 max-w-full h-2 bg-gray-800 rounded-full overflow-hidden mx-auto border border-gray-700">
        <div id="progress-bar"
          class="h-full bg-gradient-to-r from-red-600 via-pink-500 to-red-600 rounded-full shadow-lg"
          style="width: 0%; transition: width 0.3s ease-out;"></div>
      </div>

      <!-- Fun Loading Messages -->
      <p id="loading-message" class="text-gray-400 text-sm mt-6 italic">
        Preparing the popcorn... üçø
      </p>
    </div>
  </div>

  <style>
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .animate-spin {
      animation: spin 2s linear infinite;
    }

    .loading-fade-out {
      animation: fadeOut 0.6s ease-out forwards;
    }

    @keyframes fadeOut {
      0% {
        opacity: 1;
        transform: scale(1);
      }

      100% {
        opacity: 0;
        transform: scale(0.9);
      }
    }

    #loading-message {
      transition: opacity 0.3s ease;
    }

    :root {
      --accent: #ef4444;
      --accent-strong: #dc2626;
      --accent-soft: #fda4af;
      --accent-soft-bg: rgba(239, 68, 68, 0.18);
      --accent-contrast: #ffffff;
      --accent-gradient-from: #ef4444;
      --accent-gradient-to: #ec4899;
      --accent-glow: rgba(236, 72, 153, 0.35);
      --surface-card: rgba(17, 24, 39, 0.92);
      --surface-muted: rgba(30, 41, 59, 0.7);
      --surface-overlay: rgba(15, 23, 42, 0.9);
      --surface-border: rgba(148, 163, 184, 0.35);
      --text-primary: #f8fafc;
      --text-secondary: #cbd5f5;
    }

    body {
      color: var(--text-primary);
    }

    #progress-bar {
      background: linear-gradient(90deg, var(--accent-gradient-from), var(--accent-gradient-to)) !important;
    }

    .eyebrow-label {
      font-size: 0.65rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .theme-vibe-card {
      background: rgba(15, 23, 42, 0.65);
      border: 1px solid var(--surface-border);
      border-radius: 1rem;
      padding: 1rem;
    }

    body.theme-light .theme-vibe-card {
      background: var(--surface-muted);
    }

    .sort-pill {
      padding: 0.4rem 0.85rem;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid var(--surface-border);
      color: var(--text-secondary);
      transition: all 0.2s ease;
      background-color: var(--surface-muted);
    }

    .sort-pill:hover {
      border-color: var(--accent-soft);
      color: var(--text-primary);
    }

    .sort-pill.active-sort {
      background: linear-gradient(90deg, var(--accent-gradient-from), var(--accent-gradient-to));
      border-color: transparent;
      color: var(--accent-contrast);
      box-shadow: 0 10px 25px var(--accent-glow);
    }

    .logo-badge {
      background: linear-gradient(135deg, var(--accent-gradient-from), var(--accent-gradient-to)) !important;
      box-shadow: 0 18px 35px var(--accent-glow);
    }

    .bg-red-600 {
      background-color: var(--accent) !important;
    }

    .bg-red-700 {
      background-color: var(--accent-strong) !important;
    }

    .hover\:bg-red-700:hover,
    .hover\:bg-red-600:hover {
      background-color: var(--accent-strong) !important;
    }

    .bg-red-600\/20,
    .bg-red-600\/30,
    .bg-red-600\/40 {
      background-color: var(--accent-soft-bg) !important;
    }

    .text-red-400,
    .text-red-500,
    .text-red-600 {
      color: var(--accent) !important;
    }

    .border-red-600,
    .border-red-500\/30,
    .border-red-500\/40,
    .border-red-600\/30,
    .border-red-600\/40 {
      border-color: var(--accent-soft) !important;
    }

    .bg-gradient-to-r.from-red-500,
    .bg-gradient-to-r.from-red-600,
    .bg-gradient-to-r.from-red-600\/70 {
      background: linear-gradient(90deg, var(--accent-gradient-from), var(--accent-gradient-to)) !important;
    }

    .bg-gradient-to-br.from-red-600,
    .bg-gradient-to-br.from-red-500 {
      background: linear-gradient(135deg, var(--accent-gradient-from), var(--accent-gradient-to)) !important;
    }

    #notification-count,
    #for-you-row .badge.bg-red-600,
    #collection-picker .badge.bg-red-600 {
      background-color: var(--accent-strong) !important;
    }

    .theme-toggle-btn,
    .mobile-theme-btn,
    .vibe-btn,
    .mobile-vibe-btn {
      border-radius: 0.75rem;
      padding: 0.45rem 0.85rem;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid var(--surface-border);
      color: var(--text-secondary);
      background-color: rgba(148, 163, 184, 0.08);
      transition: all 0.2s ease;
    }

    .theme-toggle-btn.active,
    .mobile-theme-btn.active,
    .vibe-btn.active,
    .mobile-vibe-btn.active {
      color: var(--accent-contrast);
      border-color: transparent;
      background: linear-gradient(90deg, var(--accent-gradient-from), var(--accent-gradient-to));
      box-shadow: 0 12px 32px var(--accent-glow);
    }

    .theme-toggle-btn:hover,
    .mobile-theme-btn:hover,
    .vibe-btn:hover,
    .mobile-vibe-btn:hover {
      color: var(--accent-contrast);
      background: linear-gradient(90deg, var(--accent-gradient-from), var(--accent-gradient-to));
    }

    body.theme-light {
      background-color: #f6f6f6;
      color: var(--text-primary);
      --surface-card: #ffffff;
      --surface-muted: #f8fafc;
      --surface-overlay: rgba(255, 255, 255, 0.98);
      --surface-border: #e0e7ff;
      --text-primary: #0f172a;
      --text-secondary: #475569;
    }

    body.theme-light .bg-gray-900,
    body.theme-light .bg-gray-900\/80,
    body.theme-light .bg-gray-900\/70,
    body.theme-light .bg-gray-900\/60,
    body.theme-light .bg-gray-900\/50,
    body.theme-light .bg-gray-900\/40,
    body.theme-light .bg-gray-800,
    body.theme-light .bg-gray-800\/80,
    body.theme-light .bg-gray-800\/70,
    body.theme-light .bg-gray-800\/60,
    body.theme-light .bg-gray-800\/50,
    body.theme-light .bg-gray-700,
    body.theme-light .bg-gray-700\/80,
    body.theme-light .bg-gray-700\/60,
    body.theme-light .bg-gray-700\/50,
    body.theme-light .bg-gray-700\/40,
    body.theme-light .bg-gray-600\/60 {
      background-color: var(--surface-card) !important;
      color: var(--text-primary) !important;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
    }

    body.theme-light .bg-gray-900\/30,
    body.theme-light .bg-gray-900\/20 {
      background-color: var(--surface-muted) !important;
    }

    body.theme-light .text-white {
      color: var(--text-primary) !important;
    }

    body.theme-light .text-gray-400,
    body.theme-light .text-gray-500,
    body.theme-light .text-gray-300 {
      color: var(--text-secondary) !important;
    }

    body.theme-light .border-gray-700,
    body.theme-light .border-gray-800,
    body.theme-light .border-gray-900,
    body.theme-light .border-gray-900\/60,
    body.theme-light .border-gray-900\/30,
    body.theme-light .border-gray-700\/60 {
      border-color: var(--surface-border) !important;
    }

    body.theme-light .text-gray-100,
    body.theme-light .text-gray-200 {
      color: var(--text-primary) !important;
    }

    body.theme-light header.bg-gradient-to-r {
      background: linear-gradient(90deg, var(--surface-overlay), #f5f5f5) !important;
      border-bottom: 1px solid var(--surface-border) !important;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.08) !important;
    }

    body.theme-light #mobile-menu {
      background-color: rgba(15, 23, 42, 0.2) !important;
    }

    body.theme-light #mobile-menu>div {
      background: var(--surface-overlay) !important;
      border-left: 1px solid var(--surface-border) !important;
      color: var(--text-primary) !important;
    }

    body.theme-light #mobile-profile-card {
      background-color: var(--surface-muted) !important;
      border-color: var(--surface-border) !important;
    }

    body.theme-light #headings-overlay>div,
    body.theme-light #toplist-overlay>div,
    body.theme-light #notifications-panel,
    body.theme-light #profile-dropdown,
    body.theme-light #collection-picker,
    body.theme-light #detail-modal .bg-gray-900,
    body.theme-light .section-wrapper {
      background-color: var(--surface-overlay) !important;
      border-color: var(--surface-border) !important;
      color: var(--text-primary) !important;
    }

    body.theme-light #detail-modal {
      background-color: rgba(15, 23, 42, 0.2) !important;
    }

    body.theme-light #headings-overlay input,
    body.theme-light #search-input,
    body.theme-light #filters-panel select,
    body.theme-light #filters-panel input,
    body.theme-light #filters-panel button {
      color: var(--text-primary) !important;
    }

    body.theme-light #ai-banner,
    body.theme-light #sort-showcase,
    body.theme-light #filters-results,
    body.theme-light #for-you-section,
    body.theme-light #best-headings,
    body.theme-light #collections-section,
    body.theme-light #contextual-filter-bar,
    body.theme-light #filters-panel,
    body.theme-light #filters-summary {
      background-color: var(--surface-card) !important;
      border-color: var(--surface-border) !important;
    }

    body.theme-light #sections-container .section-wrapper h2,
    body.theme-light #sections-container .section-wrapper button {
      color: var(--text-primary) !important;
    }

    body.theme-light .bg-gradient-to-r.from-gray-900,
    body.theme-light .bg-gradient-to-r.from-gray-900\/70,
    body.theme-light .bg-gradient-to-r.from-gray-800,
    body.theme-light .bg-gradient-to-b.from-gray-900 {
      background: linear-gradient(90deg, #fff, #f4f4f4) !important;
    }

    body.theme-light .hover\:bg-gray-700:hover,
    body.theme-light .hover\:bg-gray-700\/60:hover,
    body.theme-light .hover\:bg-gray-800:hover {
      background-color: var(--surface-muted) !important;
    }
  </style>

  <script>
    // Loading Screen Script
    (function () {
      const messages = [
        "Preparing the popcorn... üçø",
        "Finding the best movies... üé¨",
        "Loading awesome content... ‚ú®",
        "Almost there... üöÄ",
        "Getting everything ready... üé≠",
        "Curating your feed... üì∫",
        "Warming up the projector... üé•",
        "Dimming the lights... üí°",
        "Rolling out the red carpet... üé™"
      ];

      let idx = 0;
      const msgEl = document.getElementById('loading-message');
      const progressBar = document.getElementById('progress-bar');

      // Rotate messages
      const msgInterval = setInterval(() => {
        idx = (idx + 1) % messages.length;
        msgEl.style.opacity = '0';
        setTimeout(() => {
          msgEl.textContent = messages[idx];
          msgEl.style.opacity = '1';
        }, 300);
      }, 1000);

      // Simulate progress
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        progressBar.style.width = progress + '%';
      }, 200);

      // Hide when loaded
      function hide() {
        clearInterval(msgInterval);
        clearInterval(progressInterval);
        progressBar.style.width = '100%';

        setTimeout(() => {
          const screen = document.getElementById('loading-screen');
          if (screen) {
            screen.classList.add('loading-fade-out');
            setTimeout(() => screen.style.display = 'none', 600);
          }
        }, 400);
      }

      window.addEventListener('load', hide);
      setTimeout(hide, 5000); // Fallback
    })();
  </script>

  <!-- Header -->
  <header
    class="bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 shadow-xl p-4 sticky top-0 z-50 border-b border-red-600/30">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-4">

      <!-- Logo - Clickable to refresh -->
      <a href="index.html" class="flex items-center gap-3 hover:scale-105 transition-transform duration-200">
        <div
          class="logo-badge flex items-center justify-center rounded-lg bg-gradient-to-br from-red-600 to-red-700 px-3 py-2 shadow-lg">
          <span class="text-white font-extrabold text-lg">OUR</span>
        </div>
        <div class="logo-text">
          <div class="text-2xl font-extrabold bg-gradient-to-r from-red-500 to-pink-500 bg-clip-text text-transparent">
            Show
          </div>
          <div class="text-xs text-gray-400 tracking-wide">
            üé¨ discover ‚Ä¢ üí¨ discuss ‚Ä¢ ü§ñ recommend
          </div>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-2">
        <a href="ai.html"
          class="px-4 py-2 rounded-lg bg-purple-600/20 hover:bg-purple-600/40 border border-purple-500/30 transition-all duration-200 flex items-center gap-2">
          <span>ü§ñ</span>
          <span class="font-semibold">AI</span>
        </a>
        <a href="post.html"
          class="px-4 py-2 rounded-lg bg-blue-600/20 hover:bg-blue-600/40 border border-blue-500/30 transition-all duration-200 flex items-center gap-2">
          <span>üìù</span>
          <span class="font-semibold">Posts</span>
        </a>
        <a href="community.html"
          class="px-4 py-2 rounded-lg bg-green-600/20 hover:bg-green-600/40 border border-green-500/30 transition-all duration-200 flex items-center gap-2">
          <span>üí¨</span>
          <span class="font-semibold">Chat</span>
        </a>
        <a href="watch&download.html"
          class="px-4 py-2 rounded-lg bg-red-600/20 hover:bg-red-600/40 border border-red-500/30 transition-all duration-200 flex items-center gap-2">
          <span>üì•</span>
          <span class="font-semibold">Download</span>
          <span>üé≤</span>
          <span>Surprise Me</span>
          </button>
          <button id="install-app-btn"
            class="hidden px-4 py-2 rounded-lg bg-purple-600/20 hover:bg-purple-600/40 border border-purple-500/40 text-sm font-semibold transition-colors duration-200 flex items-center gap-2">
            <span>üì±</span>
            <span>Install App</span>
          </button>
          <div class="relative" id="notification-wrapper">
            <button id="notification-bell"
              class="relative px-3 py-2 rounded-lg bg-gray-700/60 hover:bg-gray-700 border border-gray-600 transition-all duration-200 flex items-center gap-2">
              <span>üîî</span>
              <span class="text-sm font-semibold">Alerts</span>
              <span id="notification-count"
                class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] leading-none px-1.5 py-0.5 rounded-full font-bold hidden">0</span>
            </button>
            <div id="notifications-panel"
              class="hidden absolute right-0 mt-2 bg-gray-900 border border-gray-700 rounded-xl shadow-2xl w-72 overflow-hidden z-50">
              <div class="flex items-center justify-between px-4 py-3 border-b border-gray-700">
                <p class="font-semibold">Notifications</p>
                <button id="mark-notifications-read" class="text-xs text-red-400 hover:text-red-300">Mark all</button>
              </div>
              <div id="notifications-list" class="max-h-80 overflow-y-auto divide-y divide-gray-800">
                <p class="text-xs text-gray-400 px-4 py-4">No alerts yet. You‚Äôre all caught up!</p>
              </div>
            </div>
          </div>
      </div>

      <!-- User Section -->
      <nav class="hidden md:flex items-center gap-3">
        <a href="watchlist.html" class="relative group">
          <div
            class="px-3 py-2 rounded-lg bg-yellow-600/20 hover:bg-yellow-600/40 border border-yellow-500/30 transition-all duration-200 flex items-center gap-2">
            class="px-3 py-2 rounded-lg bg-yellow-600/20 hover:bg-yellow-600/40 border border-yellow-500/30
            transition-all duration-200 flex items-center gap-2">
            <span class="text-xl">‚≠ê</span>
            <span id="watchlist-count"
              class="bg-yellow-600 text-white px-2 py-0.5 rounded-full text-xs font-bold">0</span>
@ -555,48 +497,46 @@
            class="absolute -bottom-8 left-1/2 -translate-x-1/2 bg-gray-800 text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
            Watchlist
          </span>
        </a>
      </a>

        <a href="watchlater.html" class="relative group">
          <div
            class="px-3 py-2 rounded-lg bg-cyan-600/20 hover:bg-cyan-600/40 border border-cyan-500/30 transition-all duration-200 flex items-center gap-2">
            <span class="text-xl">‚è≥</span>
            <span id="watchlater-count"
              class="bg-cyan-600 text-white px-2 py-0.5 rounded-full text-xs font-bold">0</span>
          </div>
          <span
            class="absolute -bottom-8 left-1/2 -translate-x-1/2 bg-gray-800 text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
            Watch Later
          </span>
        </a>

        <div id="profile-menu" class="ml-3 relative">
          <button id="profile-btn"
            class="flex items-center gap-2 bg-gray-700/50 hover:bg-gray-700 px-3 py-2 rounded-lg border border-gray-600/50 transition-all duration-200 hover:scale-105">
            <img id="profile-pic" src="https://via.placeholder.com/36"
              class="w-8 h-8 rounded-full border-2 border-red-500/50" alt="profile">
            <span id="profile-name" class="text-sm font-semibold">Guest</span>
            <span class="text-xs opacity-70">‚ñº</span>
      <a href="watchlater.html" class="relative group">
        <div
          class="px-3 py-2 rounded-lg bg-cyan-600/20 hover:bg-cyan-600/40 border border-cyan-500/30 transition-all duration-200 flex items-center gap-2">
          <span class="text-xl">‚è≥</span>
          <span id="watchlater-count" class="bg-cyan-600 text-white px-2 py-0.5 rounded-full text-xs font-bold">0</span>
        </div>
        <span
          class="absolute -bottom-8 left-1/2 -translate-x-1/2 bg-gray-800 text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
          Watch Later
        </span>
      </a>

      <div id="profile-menu" class="ml-3 relative">
        <button id="profile-btn"
          class="flex items-center gap-2 bg-gray-700/50 hover:bg-gray-700 px-3 py-2 rounded-lg border border-gray-600/50 transition-all duration-200 hover:scale-105">
          <img id="profile-pic" src="https://via.placeholder.com/36"
            class="w-8 h-8 rounded-full border-2 border-red-500/50" alt="profile">
          <span id="profile-name" class="text-sm font-semibold">Guest</span>
          <span class="text-xs opacity-70">‚ñº</span>
        </button>
        <div id="profile-dropdown"
          class="hidden absolute right-0 mt-2 bg-gray-800 border border-gray-700 rounded-lg shadow-2xl w-48 overflow-hidden">
          <a href="profile.html" class="block px-4 py-3 hover:bg-gray-700 transition-colors border-b border-gray-700">
            <span class="mr-2">üë§</span>Edit Profile
          </a>
          <a href="watchlist.html" class="block px-4 py-3 hover:bg-gray-700 transition-colors border-b border-gray-700">
            <span class="mr-2">‚≠ê</span>My Watchlist
          </a>
          <a href="watchlater.html"
            class="block px-4 py-3 hover:bg-gray-700 transition-colors border-b border-gray-700">
            <span class="mr-2">‚è≥</span>My Watch Later
          </a>
          <button id="logout-btn"
            class="w-full text-left px-4 py-3 text-red-400 hover:bg-red-900/30 transition-colors font-semibold">
            <span class="mr-2">üö™</span>Logout
          </button>
          <div id="profile-dropdown"
            class="hidden absolute right-0 mt-2 bg-gray-800 border border-gray-700 rounded-lg shadow-2xl w-48 overflow-hidden">
            <a href="profile.html" class="block px-4 py-3 hover:bg-gray-700 transition-colors border-b border-gray-700">
              <span class="mr-2">üë§</span>Edit Profile
            </a>
            <a href="watchlist.html"
              class="block px-4 py-3 hover:bg-gray-700 transition-colors border-b border-gray-700">
              <span class="mr-2">‚≠ê</span>My Watchlist
            </a>
            <a href="watchlater.html"
              class="block px-4 py-3 hover:bg-gray-700 transition-colors border-b border-gray-700">
              <span class="mr-2">‚è≥</span>My Watch Later
            </a>
            <button id="logout-btn"
              class="w-full text-left px-4 py-3 text-red-400 hover:bg-red-900/30 transition-colors font-semibold">
              <span class="mr-2">üö™</span>Logout
            </button>
          </div>
        </div>
      </div>
      </nav>

      <!-- Mobile Menu Button -->
