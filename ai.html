<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Favicon using emoji -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¬</text></svg>">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Recommender | OurShow</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen">

  <!-- Header -->
  <header class="bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 shadow-xl p-4 sticky top-0 z-50 border-b border-purple-600/30">
    <div class="max-w-4xl mx-auto flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-3 hover:scale-105 transition-transform">
        <div class="bg-gradient-to-br from-purple-600 to-purple-700 px-3 py-2 rounded-lg">
          <span class="text-white font-extrabold text-lg">ğŸ¤–</span>
        </div>
        <div>
          <div class="text-2xl font-extrabold bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent">
            AI Recommender
          </div>
          <div class="text-xs text-gray-400">Powered by Google Gemini</div>
        </div>
      </a>
      <a href="index.html" class="text-sm text-gray-400 hover:text-white transition">â† Back Home</a>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto p-6 space-y-6">

    <!-- Welcome Card -->
    <div class="bg-gradient-to-br from-purple-900/40 to-pink-900/40 border border-purple-500/30 rounded-xl p-6">
      <h1 class="text-3xl font-bold mb-2">ğŸ¬ What should I watch?</h1>
      <p class="text-gray-300">Tell me your mood, favorite genre, or an actor you love, and I'll recommend the perfect movie or show!</p>
    </div>

    <!-- Quick Suggestions -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
      <button class="quick-btn bg-blue-600/20 hover:bg-blue-600/40 border border-blue-500/30 p-3 rounded-lg transition-all" data-prompt="I'm feeling adventurous">
        ğŸ—ºï¸ Adventure
      </button>
      <button class="quick-btn bg-red-600/20 hover:bg-red-600/40 border border-red-500/30 p-3 rounded-lg transition-all" data-prompt="I want something scary">
        ğŸ˜± Horror
      </button>
      <button class="quick-btn bg-pink-600/20 hover:bg-pink-600/40 border border-pink-500/30 p-3 rounded-lg transition-all" data-prompt="I'm in the mood for romance">
        ğŸ’• Romance
      </button>
      <button class="quick-btn bg-yellow-600/20 hover:bg-yellow-600/40 border border-yellow-500/30 p-3 rounded-lg transition-all" data-prompt="Make me laugh">
        ğŸ˜‚ Comedy
      </button>
      <button class="quick-btn bg-purple-600/20 hover:bg-purple-600/40 border border-purple-500/30 p-3 rounded-lg transition-all" data-prompt="I want mind-bending sci-fi">
        ğŸš€ Sci-Fi
      </button>
      <button class="quick-btn bg-green-600/20 hover:bg-green-600/40 border border-green-500/30 p-3 rounded-lg transition-all" data-prompt="Something emotional and deep">
        ğŸ­ Drama
      </button>
      <button class="quick-btn bg-orange-600/20 hover:bg-orange-600/40 border border-orange-500/30 p-3 rounded-lg transition-all" data-prompt="Action-packed thriller">
        ğŸ’¥ Action
      </button>
      <button class="quick-btn bg-indigo-600/20 hover:bg-indigo-600/40 border border-indigo-500/30 p-3 rounded-lg transition-all" data-prompt="Mystery to solve">
        ğŸ” Mystery
      </button>
    </div>

    <!-- Input Area -->
    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
      <label class="block text-sm font-semibold mb-3">âœ¨ Or describe what you're looking for:</label>
      <textarea id="user-input" 
                class="w-full p-4 rounded-lg bg-gray-900 border border-gray-600 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/50 outline-none transition-all resize-none" 
                rows="4" 
                placeholder="Examples:
â€¢ I'm feeling nostalgic, something from the 90s
â€¢ Movies like Inception with Leonardo DiCaprio
â€¢ A feel-good family movie for tonight
â€¢ Dark psychological thriller with plot twists"></textarea>
      
      <div class="flex items-center gap-3 mt-4">
        <button id="ask-btn" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-6 py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2">
          <span>âœ¨</span>
          <span>Get Recommendations</span>
        </button>
        <button id="clear-btn" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition-all">
          Clear
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loading" class="hidden text-center py-8">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"></div>
      <p class="mt-4 text-gray-400">AI is thinking... ğŸ¤”</p>
    </div>

    <!-- Results -->
    <div id="results" class="space-y-4"></div>

    <!-- Examples Section -->
    <div class="bg-gray-800/50 rounded-xl p-6 border border-gray-700/50">
      <h3 class="text-lg font-semibold mb-3">ğŸ’¡ Pro Tips:</h3>
      <ul class="space-y-2 text-gray-400 text-sm">
        <li>ğŸ¯ <strong>Be specific:</strong> "Sci-fi movies like Interstellar" works better than just "movies"</li>
        <li>ğŸ­ <strong>Mention actors:</strong> "Something with Tom Hanks" or "Movies starring Margot Robbie"</li>
        <li>ğŸ˜Š <strong>Describe your mood:</strong> "I'm feeling down, need something uplifting"</li>
        <li>ğŸ“… <strong>Mention eras:</strong> "Classic 80s action films" or "Recent 2023 releases"</li>
        <li>ğŸŒ <strong>Try genres:</strong> K-dramas, anime, Bollywood, documentaries, etc.</li>
      </ul>
    </div>

  </main>

  <script type="module">
    import { waitForFirebase } from './firebase-config.js';
    
    // Wait for Firebase and check auth
    try {
      await waitForFirebase();
      const { onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js');
      const auth = window.authMod;
      
      onAuthStateChanged(auth, (user) => {
        if (!user) {
          alert('âš ï¸ AI Recommender requires login. Please sign in to continue.');
          window.location.href = 'login.html';
        }
      });
    } catch (err) {
      console.error('Auth check failed:', err);
      alert('âš ï¸ Please login to use AI features');
      window.location.href = 'login.html';
    }
  </script>

  <script>
    const userInput = document.getElementById('user-input');
    const askBtn = document.getElementById('ask-btn');
    const clearBtn = document.getElementById('clear-btn');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    const quickBtns = document.querySelectorAll('.quick-btn');

    // Quick button handlers
    quickBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        userInput.value = btn.dataset.prompt;
        getRecommendations();
      });
    });

    // Main ask button
    askBtn.addEventListener('click', getRecommendations);

    // Clear button
    clearBtn.addEventListener('click', () => {
      userInput.value = '';
      results.innerHTML = '';
    });

    // Enter key to submit
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && e.ctrlKey) {
        getRecommendations();
      }
    });

    async function getRecommendations() {
      const prompt = userInput.value.trim();
      
      if (!prompt) {
        alert('Please describe what you want to watch!');
        return;
      }

      // Show loading
      loading.classList.remove('hidden');
      results.innerHTML = '';
      askBtn.disabled = true;
      askBtn.innerHTML = '<span class="animate-pulse">Thinking...</span>';

      try {
        // Build AI prompt
        const aiPrompt = `You are a movie and TV show expert. A user wants recommendations based on: "${prompt}"

Please recommend EXACTLY 5 movies or TV shows. For each recommendation, provide:
1. Title
2. Year
3. One short sentence explaining why it matches their request
4. Genre

Format your response EXACTLY like this example:
1. Inception (2010) - Mind-bending sci-fi thriller perfect for your request | Sci-Fi/Thriller
2. The Matrix (1999) - Revolutionary action with deep philosophical themes | Sci-Fi/Action

Keep each description to ONE sentence. Be concise and helpful.`;

        // Call Gemini API
        const aiResponse = await geminiCall(aiPrompt);
        
        if (!aiResponse) {
          throw new Error('AI did not respond');
        }

        // Parse and display results
        displayResults(aiResponse, prompt);

      } catch (error) {
        console.error('AI Error:', error);
        results.innerHTML = `
          <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-6 text-center">
            <p class="text-xl mb-2">ğŸ˜” Oops!</p>
            <p class="text-gray-300">Something went wrong with the AI. Please try again!</p>
            <p class="text-sm text-gray-500 mt-2">Error: ${error.message}</p>
          </div>
        `;
      } finally {
        loading.classList.add('hidden');
        askBtn.disabled = false;
        askBtn.innerHTML = '<span>âœ¨</span><span>Get Recommendations</span>';
      }
    }

    function displayResults(aiText, originalPrompt) {
      // Parse AI response
      const lines = aiText.split('\n').filter(line => line.trim());
      
      let html = `
        <div class="bg-gradient-to-br from-purple-900/30 to-pink-900/30 border border-purple-500/30 rounded-xl p-6">
          <h2 class="text-2xl font-bold mb-2">ğŸ¬ Here's what I recommend:</h2>
          <p class="text-gray-400 text-sm mb-4">Based on: "${originalPrompt}"</p>
          <div class="space-y-3">
      `;

      let count = 0;
      for (const line of lines) {
        // Match pattern like: 1. Title (Year) - Description | Genre
        const match = line.match(/^\d+\.\s*(.+?)\s*\((\d{4})\)\s*-\s*(.+?)\s*\|\s*(.+)$/);
        
        if (match && count < 5) {
          const [, title, year, description, genre] = match;
          count++;
          
          html += `
            <div class="bg-gray-800/50 rounded-lg p-4 hover:bg-gray-800 transition-all cursor-pointer border border-gray-700/50 hover:border-purple-500/50" onclick="searchMovie('${title.replace(/'/g, "\\'")}')">
              <div class="flex items-start gap-3">
                <div class="text-2xl">${count}</div>
                <div class="flex-1">
                  <h3 class="font-bold text-lg text-purple-400">${title} <span class="text-gray-500 text-sm">(${year})</span></h3>
                  <p class="text-gray-300 text-sm mt-1">${description}</p>
                  <div class="flex gap-2 mt-2">
                    <span class="text-xs bg-purple-600/30 px-2 py-1 rounded">${genre}</span>
                    <span class="text-xs text-gray-500">Click to search on main site â†’</span>
                  </div>
                </div>
              </div>
            </div>
          `;
        }
      }

      html += `
          </div>
        </div>
        
        <div class="text-center">
          <button onclick="getRecommendations()" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition-all">
            ğŸ”„ Get New Recommendations
          </button>
        </div>
      `;

      results.innerHTML = html;
    }

    function searchMovie(title) {
      // Redirect to main page with search query
      window.location.href = `index.html?search=${encodeURIComponent(title)}`;
    }

    // Global function for inline onclick
    window.searchMovie = searchMovie;
    window.getRecommendations = getRecommendations;
  </script>

</body>
</html>